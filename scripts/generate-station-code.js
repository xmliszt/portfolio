const fs = require('fs');
const path = require('path');

// Read all station files
const stationsDir = path.join(__dirname, '../app/craft/stations');
const outputFile = path.join(
  __dirname,
  '../app/craft/__generated__/generated-stations.ts'
);

// Get all .tsx files
const stationFiles = fs
  .readdirSync(stationsDir)
  .filter((file) => file.endsWith('.tsx'));

// Create output directory if it doesn't exist
const outputDir = path.dirname(outputFile);
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

// Generate the output
let output = `// Auto-generated file - DO NOT EDIT
// Generated by generate-station-code.js

export const stationCode = {
`;

// Add each file as a string
stationFiles.forEach((file) => {
  const name = path.basename(file, '.tsx');
  if (name === 'README' || name.startsWith('.')) return;

  const content = fs.readFileSync(path.join(stationsDir, file), 'utf8');
  // Escape backticks and interpolation markers for template strings
  const escapedContent = content.replace(/`/g, '\\`').replace(/\${/g, '\\${');

  output += `  '${name}': \`${escapedContent}\`,\n`;
});

output += `} as const;\n`;

// Write the output file
fs.writeFileSync(outputFile, output);
console.log(
  `Generated ${stationFiles.length} station code strings in ${outputFile}`
);
